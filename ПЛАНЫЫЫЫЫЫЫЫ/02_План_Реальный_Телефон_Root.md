---
name: Система подтверждения возраста КСО - Реальный телефон с Root
overview: Реализация системы на реальном Android устройстве (Redmi A1) с root правами. Полная автоматизация включая биометрию через root команды.
device: Реальный Android телефон (Redmi A1 2/32)
root: Требуется (для автоматизации биометрии)
---

# План реализации для реального телефона с Root

Этот план описывает реализацию на реальном Android устройстве с root правами.

## Преимущества реального телефона:

- Реальная камера (не нужна виртуальная)
- Реальный сканер отпечатка пальца
- Можно использовать root команды для полной автоматизации
- Более стабильная работа приложения Макс

## Отличия от Bluestacks:

### 1. Камера:
- **Вместо виртуальной камеры**: показываем QR код на экране компьютера/планшета
- Телефон физически сканирует QR код с экрана
- Или используем второй экран/монитор для отображения QR

### 2. ADB подключение:
- Подключение через USB: `adb devices`
- Или через WiFi ADB: `adb connect <IP>:5555`
- Требуется включить USB отладку на телефоне

### 3. Биометрия с Root:

**Вариант A: Root команды для эмуляции отпечатка:**

```bash
# Через su команды
adb shell su -c "service call fingerprint 1"
# или
adb shell su -c "cmd fingerprint simulate 1"
```

**Вариант B: Xposed/LSPosed модуль:**
- Установить Magisk + LSPosed
- Создать модуль, который перехватывает биометрию для пакета Макс
- Всегда возвращает успешную аутентификацию

**Вариант C: Модификация системных настроек:**
- Через root отключить требование биометрии для конкретного приложения
- Или подменить провайдер биометрии

## Структура проекта (аналогично Bluestacks):

```
money/
├── bot/                    # Telegram бот
├── server/                 # FastAPI сервер
├── macro/                  # Макросы и автоматизация
│   ├── qr_display.py      # Отображение QR на экране (вместо virtual_camera)
│   ├── biometric_handler.py # Root команды для биометрии
│   └── qr_scanner.py       # Сканирование QR через реальную камеру
└── config/                 # Конфигурация
```

## Модуль отображения QR (вместо виртуальной камеры):

**`macro/qr_display.py`:**
- Функция `display_qr_on_screen(qr_image_path)`:
  - Открывает окно на компьютере с QR кодом (fullscreen или большое окно)
  - Или отправляет QR на второй монитор/планшет
  - QR код должен быть крупным и контрастным
  - Телефон сканирует QR с этого экрана

## Модуль биометрии с Root:

**`macro/biometric_handler.py`:**

```python
def handle_fingerprint_auth_with_root():
    # Вариант 1: Root команда через ADB
    result = subprocess.run([
        'adb', 'shell', 'su', '-c', 
        'service call fingerprint 1'
    ])
    
    # Вариант 2: Если не работает, пробуем другие команды
    if result.returncode != 0:
        result = subprocess.run([
            'adb', 'shell', 'su', '-c',
            'cmd fingerprint simulate 1'
        ])
    
    # Вариант 3: Fallback на UI Automator
    if result.returncode != 0:
        # Тап на кнопку подтверждения
        tap_confirm_button()
```

## Настройка Root на Redmi A1:

1. Разблокировать bootloader (через Mi Unlock Tool)
2. Установить TWRP recovery
3. Установить Magisk для root
4. Включить USB отладку и разрешить root доступ для ADB
5. Протестировать root команды через `adb shell su`

## Критические моменты:

### Безопасность:
- Root права снижают безопасность устройства
- Нужно быть осторожным с системными командами
- Рекомендуется использовать Magisk Hide для скрытия root от приложений

### Стабильность:
- Root команды могут отличаться в зависимости от версии Android
- Нужно тестировать на конкретном устройстве
- Иметь fallback варианты (UI Automator, координаты)

### Производительность:
- Redmi A1 имеет 2GB RAM - нужно оптимизировать память
- Не запускать лишние процессы
- Очищать временные файлы

## Полный план смотри в основном файле PLAN.md
