# Блок 9.4: Функция удаления сообщения с фото модератора в его чате

## Цель

Добавить функцию `delete_moderator_own_photo_message_for_application`, которая удаляет в чате модератора сообщение с фото, которое он отправил боту (по полю `moderator_own_photo_message_id`).

## Контекст

После завершения сессии нужно удалить у модератора не только сообщение со скриншотом, но и его собственное сообщение с фото. Для этого используется сохранённый в блоке 9.2 `moderator_own_photo_message_id`. Удаление выполняется в чате модератора: `chat_id=moderator_id`, `message_id=moderator_own_photo_message_id`.

## Задачи

| № | Действие | Файл |
|---|----------|------|
| 4.1 | Добавить функцию `delete_moderator_own_photo_message_for_application(bot, application_id)` в `utils/moderator_messages.py` после `delete_moderator_screenshot_message_for_application` | `utils/moderator_messages.py` |

## Логика функции

1. Один цикл `async for session in get_session():`.
2. Загрузить сессию по `application_id` через `get_moderation_session_by_application_id`.
3. Если нет `mod_session` или нет `mod_session.moderator_own_photo_message_id` — выйти.
4. Прочитать `moderator_id` и `msg_id` в переменные (без commit до этого).
5. Вызвать `bot.delete_message(chat_id=moderator_id, message_id=msg_id)`.
6. Обнулить `mod_session.moderator_own_photo_message_id`, выполнить `await session.commit()`.
7. Обработка `TelegramBadRequest` (message not found и т.п.) — логировать, не падать.

## Чек-лист

- [x] Функция добавлена
- [x] Удаление выполняется в чате модератора (`chat_id=moderator_id`)
- [x] Ошибки Telegram обрабатываются

## Выполнено

✅ **Задача 4.1**: Добавлена функция `delete_moderator_own_photo_message_for_application(bot, application_id)` в `utils/moderator_messages.py` после `delete_moderator_screenshot_message_for_application`.

Функция реализована по той же схеме, что и исправленная функция удаления скриншота:
- Использует одну сессию БД (`async for session in get_session()`)
- Загружает сессию по `application_id` через `get_moderation_session_by_application_id`
- Проверяет наличие `mod_session` и `mod_session.moderator_own_photo_message_id`
- Читает `moderator_id` и `msg_id` в переменные до любых операций с БД
- Удаляет сообщение в Telegram через `bot.delete_message(chat_id=moderator_id, message_id=msg_id)`
- Обнуляет `mod_session.moderator_own_photo_message_id` в той же сессии
- Выполняет один `await session.commit()` в конце
- Обрабатывает `TelegramBadRequest` (message not found и т.п.) с логированием, не падает при ошибках

Теперь функция готова к использованию и будет вызываться в блоке 9.5 при approve/reject для удаления сообщения с фото модератора в его чате.
