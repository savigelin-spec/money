# Блок 7: Одно редактируемое сообщение (чистый чат)

## Обзор

Всё взаимодействие бота с пользователем должно происходить в **одном сообщении**, которое **редактируется** при каждом действии (кнопка, команда). Чат остаётся чистым: не плодятся новые сообщения при каждом нажатии.

В чате: сообщения пользователя (команды, фото) и **одно** актуальное сообщение бота (меню/экран), которое только обновляется (edit), а не дублируется (answer / send_message).

## Структура блоков

- **Блок 7.1**: Пользователь — переход в панель модератора и ошибка инвойса
- **Блок 7.2**: Модератор — одно сообщение при /moderator и во всех callback
- **Блок 7.3**: Платежи — успех и ошибка в главном сообщении
- **Блок 7.4**: Админ — одно сообщение для /admin и ответов на команды
- **Блок 7.5**: Согласованность и краевые случаи
- **Блок 7.6**: Опционально — удаление сообщения с инвойсом после оплаты

## Текущее состояние (кратко)

Уже есть: `utils/user_messages.py`, `utils/moderator_messages.py`, `utils/admin_messages.py` (get_or_create_*, update_*), `User.main_message_id`, `safe_edit_message_text`. Пользовательское меню и админ-статистика уже редактируют одно сообщение. Ломают «одно сообщение»: переход в панель модератора, /moderator, callback модератора, оплата (успех/ошибка), ошибка инвойса, /admin и ответы на команды админа. Подробно — в подблоках 7.1–7.6.
