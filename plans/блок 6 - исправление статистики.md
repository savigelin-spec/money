# –ü–ª–∞–Ω: –ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

### 1.1 –î–≤–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

| –ì–¥–µ | –ö–Ω–æ–ø–∫–∞ | callback_data | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----|--------|----------------|------------|
| –ü–∞–Ω–µ–ª—å **–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞** | ¬´üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª | `moderator_stats` | –õ–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (—Å–µ—Å—Å–∏–∏, —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è) |
| –ü–∞–Ω–µ–ª—å **–∞–¥–º–∏–Ω–∞** (/admin) | ¬´üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª | `admin_statistics` | –ë–∏–∑–Ω–µ—Å/–º–∞—Ä–∫–µ—Ç–∏–Ω–≥/—Ç—Ä–∞—Ñ–∏–∫ (–±–ª–æ–∫ 6) |

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–Ω–∞ –ø–∞–Ω–µ–ª—å **–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞** –∏ –∫–Ω–æ–ø–∫–∞ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è `callback_moderator_stats` –≤ `handlers/moderator_handlers.py`.

---

## 2. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 2.1 –ö–Ω–æ–ø–∫–∞ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª —É –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (¬´–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª)

**–°–∏–º–ø—Ç–æ–º:** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª –≤ –ø–∞–Ω–µ–ª–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –ª–∏–±–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –ª–∏–±–æ –∏–¥—ë—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –ª–∏–±–æ –≤ –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **`callback.answer()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏**  
   –ï—Å–ª–∏ –¥–æ –±–ª–æ–∫–∞ `try: edit_text(...)` –≤—ã–ª–µ—Ç–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (–ë–î, `get_or_create_moderator_stats` –∏ —Ç.–¥.), —Ç–æ `callback.answer()` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. Telegram —Ç–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø–æ –∫–Ω–æ–ø–∫–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ ¬´–∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª.

2. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ ‚Üí ¬´message is not modified¬ª**  
   –°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ‚Ä¶¬ª. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ —Ç–µ–∫—Å—Ç –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–µ –∂–µ ‚Üí Telegram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ¬´message is not modified¬ª. –°–µ–π—á–∞—Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `callback.answer()`, –Ω–æ –µ—Å–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –¥—Ä—É–≥–æ–º –≤–∏–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ë—Ä–Ω—É—Ç–æ–µ), –ø—Ä–æ–≤–µ—Ä–∫–∞ `"message is not modified" not in str(e).lower()` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å.

3. **–¢–∞–±–ª–∏—Ü–∞ `moderator_stats` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç–∞—Ä–æ–π –ë–î**  
   –ï—Å–ª–∏ –±–∞–∑–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ `ModeratorStats`, —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å ‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∂–µ –∑–∞–ø—Ä–æ—Å–µ –≤ `get_or_create_moderator_stats` –±—É–¥–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Üí —Å–Ω–æ–≤–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `callback.answer()`.

### 2.2 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–§–∞–π–ª:** `handlers/admin_statistics_handlers.py`

- **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ ¬´message is not modified¬ª**  
  –í–æ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `callback.message.edit_text(...)`. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, Telegram –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É –∏ –∞–ø–¥–µ–π—Ç –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π.

- **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `callback.answer()`**  
  –ü—Ä–∏ –ª—é–±–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ (–ë–î, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞) –¥–æ `callback.answer()` –æ–Ω–æ –Ω–µ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ ‚Üí ¬´–∑–∞–≤–∏—Å—à–∞—è¬ª –∫–Ω–æ–ø–∫–∞ —É –∞–¥–º–∏–Ω–∞.

- **`callback_stats_type`: –ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞**  
  `await callback.message.edit_text(...)` –∏ `await callback.answer()` —Å—Ç–æ—è—Ç **–≤–Ω–µ** –±–ª–æ–∫–∞ `async for session in get_session()`. –ï—Å–ª–∏ —Ü–∏–∫–ª –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Å—Ç–æ–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä), `text` –æ—Å—Ç–∞—ë—Ç—Å—è "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.", –Ω–æ –¥–∞–ª—å—à–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –∏–¥—ë—Ç `edit_text` –∏ `answer`. –ï—Å–ª–∏ –∂–µ –≤ —Ü–∏–∫–ª–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –¥–æ `edit_text` –º—ã –Ω–µ –¥–æ–π–¥—ë–º –∏ `answer()` –Ω–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è.

### 2.3 –û–±—â–∏–µ —Ä–∏—Å–∫–∏

- **–ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ ¬´message is not modified¬ª**  
  –í –æ–¥–Ω–∏—Ö –º–µ—Å—Ç–∞—Ö (user_messages, moderator_stats) –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –≤ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ ‚Äî –Ω–µ—Ç.

- **–ù–µ—Ç —è–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ TelegramBadRequest**  
  –í `user_messages.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TelegramBadRequest`; –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π `Exception` –ø–æ —Ç–µ–∫—Å—Ç—É ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö –æ—Ç API.

---

## 3. –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –≠—Ç–∞–ø 1. –ö–Ω–æ–ø–∫–∞ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞

| ‚Ññ | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª |
|---|----------|------|
| 1.1 | –û–±–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `callback_moderator_stats` –≤ `try/finally` –∏ –≤ `finally` –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å `callback.answer()` (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤—ã–∑–≤–∞–Ω), —á—Ç–æ–±—ã –ø—Ä–∏ –ª—é–±–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∞ ¬´–æ—Ç–ø—É—Å–∫–∞–ª–∞—Å—å¬ª. | `handlers/moderator_handlers.py` |
| 1.2 | –í –±–ª–æ–∫–µ `except` –ø—Ä–∏ ¬´message is not modified¬ª –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ `TelegramBadRequest` –∏ –ø–æ —Ç–µ–∫—Å—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´message is not modified¬ª –≤ `str(e).lower()`). | –¢–∞–º –∂–µ |
| 1.3 | (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, –≤—ã–∑—ã–≤–∞—Ç—å `callback.answer("–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã")`, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å. | –¢–∞–º –∂–µ |

### –≠—Ç–∞–ø 2. –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π answer –≤ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

| ‚Ññ | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª |
|---|----------|------|
| 2.1 | –í `callback_admin_statistics`, `callback_stats_period`, `callback_stats_type`, `callback_admin_panel_back` –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤—ã–∑–æ–≤ `callback.answer()` –≤–æ –≤—Å–µ—Ö –ø—É—Ç—è—Ö: –æ–±–µ—Ä–Ω—É—Ç—å –ª–æ–≥–∏–∫—É –≤ `try/finally` –∏ –≤ `finally` –≤—ã–∑—ã–≤–∞—Ç—å `callback.answer()` (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π ¬´–µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤—ã–∑–≤–∞–Ω¬ª, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è). | `handlers/admin_statistics_handlers.py` |
| 2.2 | –í–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `edit_text`, –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤—ã–∑–æ–≤ –≤ try/except –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `TelegramBadRequest` —Å —Ç–µ–∫—Å—Ç–æ–º ¬´message is not modified¬ª: –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —Å—á–∏—Ç–∞—Ç—å —É—Å–ø–µ—Ö–æ–º. | –¢–∞–º –∂–µ |

### –≠—Ç–∞–ø 3. –ï–¥–∏–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ¬´message is not modified¬ª

| ‚Ññ | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª |
|---|----------|------|
| 3.1 | –í—ã–Ω–µ—Å—Ç–∏ –≤ —É—Ç–∏–ª–∏—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `utils/telegram_helpers.py`) —Ñ—É–Ω–∫—Ü–∏—é –≤–∏–¥–∞ `safe_edit_message_text(bot, chat_id, message_id, text, reply_markup=None)`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç `edit_message_text` –∏ –ø—Ä–∏ `TelegramBadRequest` —Å ¬´message is not modified¬ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–∫–∏. | –ù–æ–≤—ã–π –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `utils/` |
| 3.2 | –ü–æ –∂–µ–ª–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å try/except. | `handlers/admin_statistics_handlers.py`, `handlers/moderator_handlers.py` |

### –≠—Ç–∞–ø 4. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

| ‚Ññ | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª |
|---|----------|------|
| 4.1 | –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `moderator_stats` —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ `init_db()` (–æ–Ω–∞ –µ—Å—Ç—å –≤ `Base.metadata`). –î–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ë–î –±–µ–∑ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –º–∏–≥—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `migrate_add_traffic_tracking.py` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç) —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `moderator_stats` –ø–æ —Å—Ö–µ–º–µ –∏–∑ –º–æ–¥–µ–ª–∏. | `scripts/` |
| 4.2 | –ü–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–∞–º–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ø–∏–∏ –ë–î –∏–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª —É –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–µ–∑ –æ—à–∏–±–æ–∫. | ‚Äî |

### –≠—Ç–∞–ø 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç—ã

| ‚Ññ | –î–µ–π—Å—Ç–≤–∏–µ |
|---|----------|
| 5.1 | –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä: –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å ‚Üí –Ω–∞–∂–∞—Ç—å ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–ª–æ–∫ ¬´–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª –∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ ¬´–≤–∏—Å–∏—Ç¬ª. –ù–∞–∂–∞—Ç—å ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª –µ—â—ë —Ä–∞–∑ ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã¬ª. |
| 5.2 | –ê–¥–º–∏–Ω: /admin ‚Üí ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª ‚Üí –≤—ã–±–æ—Ä —Ä–∞–∑–¥–µ–ª–∞ (—Ñ–∏–Ω–∞–Ω—Å—ã, –∑–∞—è–≤–∫–∏, —Ç—Ä–∞—Ñ–∏–∫ –∏ —Ç.–¥.) ‚Äî –≤–µ–∑–¥–µ –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è `callback.answer()`, –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ¬´message is not modified¬ª –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–±–æ—Ä–µ —Ç–æ–≥–æ –∂–µ —Ä–∞–∑–¥–µ–ª–∞. |
| 5.3 | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–π –ë–î –∏–ª–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ–π: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–π–º–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∏ –≤ `finally` –≤—ã–∑–≤–∞—Ç—å `callback.answer()`, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–≤–∏—Å–∞–ª. |

---

## 4. –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫-–ª–∏—Å—Ç –ø–æ –∫–æ–¥—É

- [x] `callback_moderator_stats`: try/finally —Å `callback.answer()`; –æ–±—Ä–∞–±–æ—Ç–∫–∞ ¬´message is not modified¬ª; —Ç–æ—Å—Ç ¬´–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã¬ª.
- [x] `callback_admin_statistics`: safe_edit_message_text + try/finally —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º answer.
- [x] `callback_stats_period`: —Ç–æ –∂–µ + –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π answer.
- [x] `callback_stats_type`: —Ç–æ –∂–µ; –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤ —Ü–∏–∫–ª–µ answer –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ finally.
- [x] `callback_admin_panel_back`: —Ç–æ –∂–µ.
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `moderator_stats` –≤ migrate_add_traffic_tracking.py (CREATE TABLE IF NOT EXISTS).
- [x] –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `safe_edit_message_text` –≤ utils/telegram_helpers.py –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–µ.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª —É –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –∏ –≤—Å—è –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏.
