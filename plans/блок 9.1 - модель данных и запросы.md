# Блок 9.1: Модель данных и запросы для message_id фото модератора в его чате

## Цель

Добавить поле для хранения message_id сообщения модератора в его чате (которое он отправил боту) и функцию для его сохранения.

## Контекст

Когда модератор отправляет фото в бот, это сообщение остаётся в его чате. Чтобы удалить его при завершении сессии, нужно сохранять `message.message_id` и затем вызывать `bot.delete_message(chat_id=moderator_id, message_id=...)`.

## Задачи

| № | Действие | Файл |
|---|----------|------|
| 1.1 | Добавить поле `moderator_own_photo_message_id: Mapped[int \| None]` в класс `ModerationSession` (после `moderator_screenshot_message_id`) | `database/models.py` |
| 1.2 | Добавить миграцию для колонки `moderator_own_photo_message_id` (функция `_ensure_moderator_own_photo_message_id_column` и вызов в `run_async_migrations`) | `database/db.py` |
| 1.3 | Добавить функцию `set_moderator_own_photo_message_id(session, session_id, message_id)` в `database/queries.py` | `database/queries.py` |

## Детали

**Модель** (`database/models.py`):

```python
moderator_own_photo_message_id: Mapped[int | None] = mapped_column(Integer, nullable=True)
```

**Функция** (`database/queries.py`): по аналогии с `set_moderator_screenshot_message_id` — выборка `ModerationSession` по `session_id`, установка `moderator_own_photo_message_id`, `flush`.

**Миграция** (`database/db.py`): по аналогии с `_ensure_moderator_screenshot_message_id_column` — проверка наличия колонки в `moderation_sessions`, при отсутствии `ALTER TABLE ... ADD COLUMN moderator_own_photo_message_id INTEGER`.

## Чек-лист

- [x] Поле добавлено в модель
- [x] Миграция добавлена и вызывается при старте
- [x] Функция `set_moderator_own_photo_message_id` добавлена в queries

## Выполнено

✅ **Задача 1.1**: Добавлено поле `moderator_own_photo_message_id: Mapped[int | None]` в класс `ModerationSession` после `moderator_screenshot_message_id` в `database/models.py`.

✅ **Задача 1.2**: Добавлена функция миграции `_ensure_moderator_own_photo_message_id_column` в `database/db.py` и её вызов в `init_db()` для автоматического добавления колонки при старте приложения.

✅ **Задача 1.3**: Добавлена функция `set_moderator_own_photo_message_id(session, session_id, message_id)` в `database/queries.py` по аналогии с `set_moderator_screenshot_message_id` для сохранения message_id сообщения модератора в его чате.
