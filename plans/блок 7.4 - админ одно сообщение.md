# Блок 7.4: Админ — одно сообщение для /admin и ответов на команды

## Цель

При вызове /admin и при выполнении команд админа (/set_role, /list_users, /user_info и т.д.) показывать результат в одном редактируемом сообщении, а не отправлять новые.

## Контекст

- Сейчас `cmd_admin` вызывает `message.answer(admin_text)` — новое сообщение.
- Все обработчики команд (/set_role, /set_moderator, /remove_moderator, /list_users, /user_info) используют `message.answer(...)` — каждое действие добавляет новое сообщение.

Используем: `get_or_create_admin_message`, `update_admin_message` из `utils.admin_messages`. При необходимости — клавиатура админ-панели из `keyboards.admin_keyboards` (проверить наличие и название).

## Задачи

| № | Действие | Файл |
|---|----------|------|
| 4.1 | В `cmd_admin`: убрать `message.answer(admin_text)`; вызывать `get_or_create_admin_message` или `update_admin_message` с `admin_text` и клавиатурой админ-панели (если есть в `keyboards.admin_keyboards`). | `handlers/admin_handlers.py` |
| 4.2 | В обработчиках команд `/set_role`, `/set_moderator`, `/remove_moderator`, `/list_users`, `/user_info`: вместо `message.answer(...)` вызывать `update_admin_message(bot, message.from_user.id, result_text, reply_markup=...)` с клавиатурой «Назад в админ-панель» при необходимости. Импортировать `update_admin_message` из `utils.admin_messages`. | `handlers/admin_handlers.py` |

## Чек-лист

- [x] `cmd_admin`: показ панели через `get_or_create_admin_message` / `update_admin_message`.
- [x] Ответы на команды админа (/set_role, /list_users, /user_info и др.) через `update_admin_message`.

## Выполнено

✅ **Задача 4.1**: В `cmd_admin` заменён `message.answer(admin_text)` на `get_or_create_admin_message` с текстом панели администратора и клавиатурой админ-панели (`get_admin_panel_keyboard()`).

✅ **Задача 4.2**: Во всех обработчиках команд админа заменён `message.answer(...)` на `update_admin_message` с клавиатурой админ-панели. Обновлены следующие команды:
- `/set_role` — все ответы (ошибки валидации, успех, исключения)
- `/set_moderator` — все ответы
- `/remove_moderator` — все ответы
- `/user_info` — все ответы
- `/list_users` — все ответы

✅ Добавлены импорты: `get_or_create_admin_message` и `update_admin_message` из `utils.admin_messages`, `get_admin_panel_keyboard` из `keyboards.admin_keyboards`.

**Примечание**: Оставлены `message.answer` в функции `check_admin_access` для сообщений об отсутствии прав доступа — это корректно, так как это не часть основного взаимодействия с админ-панелью.
