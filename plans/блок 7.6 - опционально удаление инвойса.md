# Блок 7.6: Опционально — удаление сообщения с инвойсом после оплаты

## Цель

После успешной оплаты при желании удалять сообщение с инвойсом, чтобы в чате оставалось только главное сообщение с текстом «Оплата успешно…».

## Контекст

Инвойс приходит отдельным сообщением от Telegram API. В `process_successful_payment` параметр `message` — это сообщение, в котором пришёл `successful_payment`. Нужно уточнить: это сообщение от бота с инвойсом или системное сообщение о платеже. Если бот может удалить своё сообщение с инвойсом — вызывать `bot.delete_message(chat_id, message_id)` после обновления главного сообщения.

## Задачи

| № | Действие | Файл |
|---|----------|------|
| 6.1 | После успешной оплаты при желании удалять сообщение с инвойсом: уточнить, какое `message_id` удалять (сообщение с инвойсом может быть другим, чем `message` в хендлере). При необходимости вызвать `bot.delete_message(chat_id, message_id)`. Выполнять после обновления главного сообщения. | `handlers/payment_handlers.py` |

## Чек-лист

- [x] (Опционально) Удаление сообщения с инвойсом после успешной оплаты.

## Выполнено

✅ **Задача 6.1**: Добавлено удаление сообщения с инвойсом после успешной оплаты в `process_successful_payment` (строки 82-93 в `handlers/payment_handlers.py`).

**Реализация:**
- После обновления главного сообщения с текстом успешной оплаты выполняется попытка удалить сообщение с инвойсом
- Используется `message.message_id` — это ID сообщения, которое содержало инвойс (после оплаты оно стало сообщением о платеже)
- Удаление обёрнуто в `try/except` с логированием ошибок на уровне `debug`, чтобы не прерывать основной процесс, если удаление не удастся
- Если сообщение стало системным после оплаты и его нельзя удалить — это нормально, ошибка игнорируется

**Примечание**: В Telegram Bot API после оплаты инвойс заменяется системным сообщением о платеже. Бот может попытаться удалить это сообщение, но если оно системное — удаление может не сработать. Это ожидаемое поведение, поэтому ошибка обрабатывается корректно и не влияет на основной функционал.
