# Блок 7.3: Платежи — успех и ошибка в главном сообщении

## Цель

Результат успешной оплаты и сообщение об ошибке обработки платежа показывать в главном сообщении пользователя, а не отправлять новыми сообщениями.

## Контекст

- Сейчас в `process_successful_payment` вызывается `message.answer(success_text, ...)` — новое сообщение.
- В блоке `except` при ошибке — `message.answer(...)` — тоже новое сообщение.

Используем: `update_user_main_message` из `utils.user_messages`, `get_back_to_menu_keyboard` из `keyboards.user_keyboards`.

## Задачи

| № | Действие | Файл |
|---|----------|------|
| 3.1 | В `process_successful_payment`: вместо `message.answer(success_text, ...)` вызывать `update_user_main_message(message.bot, message.from_user.id, success_text, get_back_to_menu_keyboard())`. Импортировать `update_user_main_message` из `utils.user_messages`. | `handlers/payment_handlers.py` |
| 3.2 | В блоке `except` при ошибке обработки платежа: вместо `message.answer(...)` вызывать `update_user_main_message(...)` с текстом ошибки и `get_back_to_menu_keyboard()`. | `handlers/payment_handlers.py` |

## Чек-лист

- [x] `process_successful_payment`: успех через `update_user_main_message`.
- [x] `process_successful_payment`: ошибка через `update_user_main_message`.

## Выполнено

✅ **Задача 3.1**: В `process_successful_payment` заменён `message.answer(success_text, ...)` на `update_user_main_message` с текстом успешной оплаты и клавиатурой "Назад в меню".

✅ **Задача 3.2**: В блоке `except` при ошибке обработки платежа заменён `message.answer(...)` на `update_user_main_message` с текстом ошибки и клавиатурой "Назад в меню".

✅ Добавлен импорт `update_user_main_message` из `utils.user_messages`.
